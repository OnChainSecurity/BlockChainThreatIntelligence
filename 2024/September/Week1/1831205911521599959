{
    "threat_intelligence": {
        "url": "https://x.com/Phalcon_xyz/status/1831205911521599959",
        "timestamp": "2024-09-04 13:41:26",
        "original_content": "A few hours ago, Penpie\n\n[@Penpiexyz_io](/Penpiexyz_io)\n\n, a farming protocol built on the Pendle Protocol, suffered a reentrancy\nattack resulting in a loss of ~$27M. Since Penpie has been paused, we are now\nproviding a detailed root cause analysis. This is a typical issue due to the\nlack of reentrancy guard. Specifically, the vulnerable contract (0xff51c6, the\nimplementation contract of PendleStaking) fails to consider that the provided\nargument, i.e., markets, might be untrusted, which can abused to reenter into\nthis contract. Attack preparation TX:\n[https://app.blocksec.com/explorer/tx/eth/0x7e7f9548f301d3dd863eac94e6190cb742ab6aa9d7730549ff743bf84cbd21d1\u2026](https://t.co/GfqcLFioiO)\nThe attacker initially created a counterfeit SY (standardized yield token,\ni.e., 0x4476b). Although the SY tokens themselves were worthless, the contract\nwas set up with two high-value PENDLE-LPT market tokens (i.e., 0x6010_PENDLE-\nLPT, 0x038c_PENDLE-LPT) as the reward tokens. By doing so, the attacker then\ncreated a market on Pendle and registered it on Penpie. Attack TX:\n[https://app.blocksec.com/explorer/tx/eth/0x42b2ec27c732100dd9037c76da415e10329ea41598de453bb0c0c9ea7ce0d8e5\u2026](https://t.co/tyI6SmL5Ao)\nDuring the attack, the attacker executed the batchHarvestMarketRewards()\nfunction to harvest rewards, which were calculated based on the difference in\nbalanceOf() before and after the redeemRewards() function was invoked. The\nredeemRewards() function, in turn, triggered the claimRewards() function of\nthe specific market. As the protocol did not anticipate the possibility of a\nmarket being maliciously controlled, the attacker was able to re-enter the\nvictim contract through the depositMarket() function. After that, the attacker\ndeposited the two high-value LPT market tokens, which were mistakenly treated\nas rewards. Simultaneously, the attacker received minted shares corresponding\nto these deposits. Consequently, the attacker could withdraw the same valuable\nLPT market tokens along with the corresponding shares minted in\ndepositMarket(), and claim the reward to realize a profit."
    }
}